name: Deploy on Server

on:
  push:
     branches: ["master"]

jobs:
  build:
    runs-on: self-hosted

    steps:
    - name: Check out repository code
      uses: actions/checkout@v3

    - name: Stop all running docker containers
      run: |
        docker ps -q | grep . && docker-compose down || echo "No containers running, skipping docker-compose down."

    - name: Run all containers
      working-directory: /home/max/Film.me
      run: docker-compose up --build -d